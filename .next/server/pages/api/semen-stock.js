"use strict";(()=>{var e={};e.id=5385,e.ids=[5385],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1596:(e,a,t)=>{t.r(a),t.d(a,{config:()=>u,default:()=>c,routeModule:()=>l});var o={};t.r(o),t.d(o,{default:()=>handler});var r=t(1802),n=t(7153),s=t(6249),d=t(3524);let i=new d.PrismaClient;async function handler(e,a){if("GET"===e.method)try{let e=await i.semenStock.findMany({include:{container:!0,caneca:!0,user:{select:{name:!0}}},orderBy:{createdAt:"desc"}}),t=e.map(e=>({id:e.id,nomeTouro:e.nomeTouro,rg:e.rg,raca:e.raca,fornecedor:e.fornecedor,notaFiscal:e.notaFiscal,quantidadeTotal:e.quantidadeTotal,quantidadeDisponivel:e.quantidadeDisponivel,quantidadeUsada:e.quantidadeUsada,valorUnitario:e.valorUnitario,dataEntrada:e.dataEntrada,dataColeta:e.dataColeta,dataVencimento:e.dataVencimento,botijaoNumero:e.container.botijaoNumero,canecaNumero:e.caneca.numero,posicao:e.posicao,status:e.status.toLowerCase(),responsavel:e.responsavel,observacoes:e.observacoes}));a.status(200).json(t)}catch(e){console.error("Erro ao buscar estoque de s\xeamen:",e),a.status(500).json({error:"Erro interno do servidor"})}else if("POST"===e.method)try{let{nomeTouro:t,rg:o,raca:r,fornecedor:n,notaFiscal:s,quantidadeDoses:d,valorUnitario:c,dataColeta:u,dataVencimento:l,botijaoNumero:m,canecaNumero:p,posicao:v,responsavel:f,observacoes:w}=e.body;if(!t||!o||!r||!d||!m||!p)return a.status(400).json({error:"Campos obrigat\xf3rios: nomeTouro, rg, raca, quantidadeDoses, botijaoNumero, canecaNumero"});let x=await i.semenContainer.findFirst({where:{botijaoNumero:m}});x||(x=await i.semenContainer.create({data:{botijaoNumero:m,capacidade:500,userId:"default-user-id",status:"ATIVO"}}));let I=await i.semenCaneca.findFirst({where:{containerId:x.id,numero:p}});I||(I=await i.semenCaneca.create({data:{numero:p,capacidade:50,containerId:x.id}}));let b=await i.semenStock.create({data:{nomeTouro:t,rg:o,raca:r,fornecedor:n||"",notaFiscal:s||"",quantidadeTotal:parseInt(d),quantidadeDisponivel:parseInt(d),quantidadeUsada:0,valorUnitario:parseFloat(c)||0,dataColeta:u?new Date(u):null,dataVencimento:l?new Date(l):null,posicao:v||"",status:"DISPONIVEL",responsavel:f||"",observacoes:w||"",userId:"default-user-id",containerId:x.id,canecaId:I.id},include:{container:!0,caneca:!0}});await i.semenCaneca.update({where:{id:I.id},data:{ocupacao:{increment:parseInt(d)}}}),await i.semenMovement.create({data:{tipo:"ENTRADA",responsavel:f||"",quantidade:parseInt(d),motivo:"Compra de s\xeamen",valorUnitario:parseFloat(c)||0,observacoes:`Entrada: ${n} - NF: ${s}`,userId:"default-user-id",semenStockId:b.id,containerDestinoId:x.id}}),a.status(201).json({message:"Entrada de s\xeamen registrada com sucesso",id:b.id})}catch(e){console.error("Erro ao criar entrada de s\xeamen:",e),a.status(500).json({error:"Erro interno do servidor"})}else if("PUT"===e.method)try{let{id:t,...o}=e.body;if(!t)return a.status(400).json({error:"ID \xe9 obrigat\xf3rio para atualiza\xe7\xe3o"});let r=await i.semenStock.update({where:{id:t},data:{...o,updatedAt:new Date}});a.status(200).json({message:"Estoque de s\xeamen atualizado com sucesso",data:r})}catch(e){console.error("Erro ao atualizar s\xeamen:",e),a.status(500).json({error:"Erro interno do servidor"})}else a.setHeader("Allow",["GET","POST","PUT"]),a.status(405).end(`Method ${e.method} Not Allowed`)}let c=(0,s.l)(o,"default"),u=(0,s.l)(o,"config"),l=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/semen-stock",pathname:"/api/semen-stock",bundlePath:"",filename:""},userland:o})}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222],()=>__webpack_exec__(1596));module.exports=t})();