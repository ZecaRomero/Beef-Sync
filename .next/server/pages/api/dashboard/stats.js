"use strict";(()=>{var e={};e.id=3106,e.ids=[3106],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9028:(e,t,a)=>{a.r(t),a.d(t,{config:()=>d,default:()=>c,routeModule:()=>g});var r={};a.r(r),a.d(r,{default:()=>l});var o=a(1802),s=a(7153),n=a(6249),i=a(7864),u=a(9823);async function handler(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let a=e.user.id,r=await i._.animal.count({where:{userId:a,status:"ATIVO"}}),o=await i._.gestation.count({where:{animal:{userId:a},status:"GESTANTE"}}),s=await i._.alert.count({where:{userId:a,status:"PENDENTE"}}),n=new Date,u=new Date(n.getFullYear(),n.getMonth(),1),l=new Date(n.getFullYear(),n.getMonth()+1,0),c=await i._.cost.aggregate({where:{userId:a,data:{gte:u,lte:l}},_sum:{valor:!0}}),d=await i._.animal.groupBy({by:["categoria"],where:{userId:a,status:"ATIVO"},_count:{categoria:!0}}),g=new Date;g.setDate(g.getDate()-30);let p=await i._.cost.groupBy({by:["tipo"],where:{userId:a,data:{gte:g}},_sum:{valor:!0},_count:{tipo:!0}}),m=new Date;m.setDate(m.getDate()+30);let _=await i._.gestation.findMany({where:{animal:{userId:a},status:"GESTANTE",dataPrevParto:{gte:n,lte:m}},include:{animal:{select:{brinco:!0,nome:!0}}},orderBy:{dataPrevParto:"asc"}});t.status(200).json({totalAnimals:r,totalGestations:o,pendingAlerts:s,monthlyCosts:c._sum.valor||0,animalsByCategory:d.map(e=>({categoria:e.categoria||"Sem categoria",count:e._count.categoria})),costsByType:p.map(e=>({tipo:e.tipo,total:e._sum.valor,count:e._count.tipo})),upcomingBirths:_})}catch(e){console.error("Dashboard stats error:",e),t.status(500).json({message:"Erro ao buscar estat\xedsticas"})}}let l=(0,u.QO)(handler),c=(0,n.l)(r,"default"),d=(0,n.l)(r,"config"),g=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboard/stats",pathname:"/api/dashboard/stats",bundlePath:"",filename:""},userland:r})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,9823],()=>__webpack_exec__(9028));module.exports=a})();