"use strict";(()=>{var e={};e.id=9552,e.ids=[9552],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9131:(e,a,t)=>{t.r(a),t.d(a,{config:()=>u,default:()=>c,routeModule:()=>l});var n={};t.r(n),t.d(n,{default:()=>handler});var o=t(1802),r=t(7153),i=t(8781),s=t(3524);let d=new s.PrismaClient;async function handler(e,a){if("GET"===e.method)try{let{type:t,startDate:n,endDate:o}=e.query,r={};switch(t){case"estoque":r=await generateEstoqueReport();break;case"movimentacoes":r=await generateMovimentacoesReport(n,o);break;case"vencimentos":r=await generateVencimentosReport();break;case"financeiro":r=await generateFinanceiroReport(n,o);break;default:return a.status(400).json({error:"Tipo de relat\xf3rio inv\xe1lido"})}a.status(200).json(r)}catch(e){console.error("Erro ao gerar relat\xf3rio:",e),a.status(500).json({error:"Erro interno do servidor"})}else a.setHeader("Allow",["GET"]),a.status(405).end(`Method ${e.method} Not Allowed`)}async function generateEstoqueReport(){let e=await d.semenStock.findMany({include:{container:!0,caneca:!0},where:{quantidadeDisponivel:{gt:0}}}),a=e.reduce((e,a)=>e+a.quantidadeDisponivel,0),t=new Set(e.map(e=>e.nomeTouro)).size,n=e.reduce((e,a)=>e+a.quantidadeDisponivel*a.valorUnitario,0),o=new Date,r=e.filter(e=>{if(!e.dataVencimento)return!1;let a=Math.ceil((new Date(e.dataVencimento)-o)/864e5);return a<=30&&a>=0}).length,i=e.map(e=>({nomeTouro:e.nomeTouro,rg:e.rg,raca:e.raca,quantidadeDisponivel:e.quantidadeDisponivel,valorUnitario:e.valorUnitario,dataVencimento:e.dataVencimento,botijaoNumero:e.container.botijaoNumero,canecaNumero:e.caneca.numero}));return{totalDoses:a,totalTouros:t,valorTotal:n,dosesVencendo:r,detalhes:i}}async function generateMovimentacoesReport(e,a){let t={};e&&a&&(t.data={gte:new Date(e),lte:new Date(a)});let n=await d.semenMovement.findMany({where:t,include:{semenStock:{select:{nomeTouro:!0,rg:!0}}},orderBy:{data:"desc"}}),o=n.filter(e=>"ENTRADA"===e.tipo).reduce((e,a)=>e+a.quantidade,0),r=n.filter(e=>"SAIDA"===e.tipo).reduce((e,a)=>e+a.quantidade,0),i=n.filter(e=>"TRANSFERENCIA"===e.tipo).reduce((e,a)=>e+a.quantidade,0),s=n.map(e=>({data:e.data,tipo:e.tipo,nomeTouro:e.semenStock?.nomeTouro||"",rg:e.semenStock?.rg||"",quantidade:e.quantidade,responsavel:e.responsavel,motivo:e.motivo}));return{totalEntradas:o,totalSaidas:r,totalTransferencias:i,movimentacoes:s}}async function generateVencimentosReport(){let e=await d.semenStock.findMany({include:{container:!0,caneca:!0},where:{quantidadeDisponivel:{gt:0},dataVencimento:{not:null}}}),a=new Date,t=e.map(e=>{let t=Math.ceil((new Date(e.dataVencimento)-a)/864e5);return{...e,diasRestantes:t,botijaoNumero:e.container.botijaoNumero,canecaNumero:e.caneca.numero}}).sort((e,a)=>e.diasRestantes-a.diasRestantes),n=t.filter(e=>e.diasRestantes<=30&&e.diasRestantes>=0).length,o=t.filter(e=>e.diasRestantes<=7&&e.diasRestantes>=0).length,r=t.filter(e=>e.diasRestantes<0).length;return{vencendo30dias:n,vencendo7dias:o,vencidas:r,vencimentos:t}}async function generateFinanceiroReport(e,a){let t=await d.semenStock.findMany({where:{quantidadeDisponivel:{gt:0}}}),n=t.reduce((e,a)=>e+a.quantidadeDisponivel*a.valorUnitario,0),o={};e&&a&&(o.data={gte:new Date(e),lte:new Date(a)});let r=await d.semenMovement.findMany({where:{...o,tipo:"ENTRADA"}}),i=r.reduce((e,a)=>e+a.quantidade*(a.valorUnitario||0),0),s=await d.semenMovement.findMany({where:{...o,tipo:"SAIDA",valorUnitario:{gt:0}}}),c=s.reduce((e,a)=>e+a.quantidade*a.valorUnitario,0),u=t.reduce((e,a)=>e+a.quantidadeDisponivel,0);return{valorTotalEstoque:n,valorCompras:i,valorVendas:c,valorMedio:u>0?n/u:0}}let c=(0,i.l)(n,"default"),u=(0,i.l)(n,"config"),l=new o.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/semen-reports",pathname:"/api/semen-reports",bundlePath:"",filename:""},userland:n})}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222],()=>__webpack_exec__(9131));module.exports=t})();