"use strict";(()=>{var e={};e.id=3930,e.ids=[3930],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7777:(e,a,s)=>{s.r(a),s.d(a,{config:()=>l,default:()=>d,routeModule:()=>u});var r={};s.r(r),s.d(r,{default:()=>handler});var o=s(1802),n=s(7153),t=s(6249),i=s(7864);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"Method not allowed"});try{let{animalId:s,valorVenda:r,nomeComprador:o,dataVenda:n,observacoes:t}=e.body;if(console.log("\uD83D\uDCDD Registrando venda simples:",{animalId:s,valorVenda:r,nomeComprador:o,dataVenda:n}),!s||!r)return a.status(400).json({message:"Animal ID e valor da venda s\xe3o obrigat\xf3rios"});let d=await i._.animal.findUnique({where:{id:s}});if(!d)return a.status(404).json({message:"Animal n\xe3o encontrado"});let l=await i._.sale.create({data:{animalId:s,valorVenda:parseFloat(r),nomeComprador:o||"Comprador do Leil\xe3o",dataVenda:n?new Date(n):new Date,observacoes:t||`Venda registrada em ${new Date().toLocaleString("pt-BR")}`,precoKg:null,pesoVenda:null,comissao:0,taxas:0},include:{animal:!0}});console.log("✅ Venda registrada:",l),a.status(201).json({success:!0,message:`Venda de ${d.brinco} registrada com sucesso!`,sale:{id:l.id,animal:d.brinco,buyer:l.nomeComprador,value:l.valorVenda,date:l.dataVenda,notes:l.observacoes}})}catch(e){if(console.error("❌ Erro ao registrar venda:",e),"P2002"===e.code)return a.status(400).json({message:"Este animal j\xe1 possui uma venda registrada"});a.status(500).json({success:!1,message:"Erro interno do servidor ao registrar venda",error:e.message})}}let d=(0,t.l)(r,"default"),l=(0,t.l)(r,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/sales-simple",pathname:"/api/sales-simple",bundlePath:"",filename:""},userland:r})},7864:(e,a,s)=>{s.d(a,{_:()=>n});var r=s(3524);let o=globalThis,n=o.prisma||new r.PrismaClient}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222],()=>__webpack_exec__(7777));module.exports=s})();