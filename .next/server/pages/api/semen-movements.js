"use strict";(()=>{var e={};e.id=1950,e.ids=[1950],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},640:(e,o,t)=>{t.r(o),t.d(o,{config:()=>m,default:()=>u,routeModule:()=>l});var a={};t.r(a),t.d(a,{default:()=>handler});var r=t(1802),n=t(7153),i=t(8781),s=t(3524);let d=new s.PrismaClient;async function handler(e,o){if("GET"===e.method)try{let e=await d.semenMovement.findMany({include:{semenStock:{select:{nomeTouro:!0,rg:!0}},containerOrigem:{select:{botijaoNumero:!0}},containerDestino:{select:{botijaoNumero:!0}},user:{select:{name:!0}}},orderBy:{createdAt:"desc"}}),t=e.map(e=>({id:e.id,tipo:e.tipo.toLowerCase(),data:e.data,responsavel:e.responsavel,nomeTouro:e.semenStock?.nomeTouro||"",rg:e.semenStock?.rg||"",quantidade:e.quantidade,botijaoOrigem:e.containerOrigem?.botijaoNumero||null,botijaoDestino:e.containerDestino?.botijaoNumero||null,motivo:e.motivo,destinatario:e.destinatario,valorUnitario:e.valorUnitario,observacoes:e.observacoes}));o.status(200).json(t)}catch(e){console.error("Erro ao buscar movimenta\xe7\xf5es:",e),o.status(500).json({error:"Erro interno do servidor"})}else if("POST"===e.method)try{let{tipo:t,responsavel:a,quantidade:r,motivo:n,destinatario:i,valorUnitario:s,observacoes:u,containerOrigemId:m,containerDestinoId:l}=e.body,c=e.body.semenStockId;if(!t||!a||!r)return o.status(400).json({error:"Campos obrigat\xf3rios: tipo, responsavel, quantidade"});if("SAIDA"===t){let t=c;if(!t&&e.body.nomeTouro&&e.body.rg){let o=await d.semenStock.findFirst({where:{nomeTouro:e.body.nomeTouro,rg:e.body.rg,quantidadeDisponivel:{gt:0}}});t=o?.id}if(t){let e=await d.semenStock.findUnique({where:{id:t}});if(!e)return o.status(404).json({error:"Estoque de s\xeamen n\xe3o encontrado"});if(e.quantidadeDisponivel<parseInt(r))return o.status(400).json({error:"Quantidade insuficiente em estoque"});await d.semenStock.update({where:{id:t},data:{quantidadeDisponivel:{decrement:parseInt(r)},quantidadeUsada:{increment:parseInt(r)},status:e.quantidadeDisponivel-parseInt(r)==0?"USADO":e.status}});let a=await d.semenCaneca.findUnique({where:{id:e.canecaId}});a&&await d.semenCaneca.update({where:{id:a.id},data:{ocupacao:{decrement:parseInt(r)}}}),c=t}}let p=await d.semenMovement.create({data:{tipo:t.toUpperCase(),responsavel:a,quantidade:parseInt(r),motivo:n||"",destinatario:i||"",valorUnitario:parseFloat(s)||0,observacoes:u||"",userId:"default-user-id",semenStockId:c||null,containerOrigemId:m||null,containerDestinoId:l||null}});o.status(201).json({message:"Movimenta\xe7\xe3o registrada com sucesso",id:p.id})}catch(e){console.error("Erro ao criar movimenta\xe7\xe3o:",e),o.status(500).json({error:"Erro interno do servidor"})}else o.setHeader("Allow",["GET","POST"]),o.status(405).end(`Method ${e.method} Not Allowed`)}let u=(0,i.l)(a,"default"),m=(0,i.l)(a,"config"),l=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/semen-movements",pathname:"/api/semen-movements",bundlePath:"",filename:""},userland:a})}};var o=require("../../webpack-api-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),t=o.X(0,[4222],()=>__webpack_exec__(640));module.exports=t})();